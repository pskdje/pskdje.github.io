---
title: audioplay现已可用
time: 2025/01/13-16:08
---

# audioplay已基本可用

本文是在[0.3.4](/docs/changelog.html?href=audioplay.html)版本创建的，于0.4.5版本更新，详细信息请查看更新日志。

部署在本网站的audioplay的call功能会无法访问网络，由于 Github Page 是静态服务器，且配置的参数是将请求转发到12000端口，这将会导致无法访问。

可以通过一些办法来成功的使call功能来访问网络，见本文其它段落。~~名字不叫其它~~

以后可能会考虑其它功能。

## 设计思路

audioplay本身是设计来给我直播间提供背景音乐，作为OBS浏览器源使用。

核心功能有3个，分别是：

1. 获取播放列表

2. 处理播放列表

3. 播放音频

整个架构都是围绕着“播放列表”来运转。

因此，整个页面不会有多少的引导。我会在这篇文章对基本功能做一些简单介绍。（只有文本介绍，没有图片）

## 使用

在文章较末尾的地方会提供试用。

整个页面被分为2部分：其一是最顶部的浏览器默认播放控件和操作按钮；剩下的区域都用来显示播放列表条目。

在播放控件下方会有“操作”字样，后面跟着一些按钮。

点击“获取数据”按钮，按照上面的提示进行操作。目前支持从本地读取播放列表和指定链接获取播放列表，请以实际界面显示为准。

点击“修改配置”按钮，你可以对一些配置进行修改。

点击“≡”（U+2261）按钮，将打开“更多操作”窗口，可以使用更多功能。

<!-- 点击“操作:”本身，当处于调试模式下会启用调试功能。 -->

如果你加载的播放列表需要依赖，请自行加载所需的播放列表（或特殊脚本）。

成功加载播放列表后，若有播放数据，将会执行播放，若出现错误，请按照“播放失败排查”进行检查。

### 播放失败排查

有很多种情况会出现播放失败的提示，此部分会尽力覆盖大部分失败的情况，但无法保证确实能排除问题。

有很多种问题都可能导致同一种失败现象。

如果你会使用浏览器开发者工具，最好直接使用开发者工具进行检查。若页面处于调试模式下，会自动加载eruda，但注意，eruda与浏览器开发者工具来比存在一些做不到的事。（若处于调试模式可以按*“操作:”*文本来启用调试菜单，查看all和err日志）

#### 以非常快的速度疯狂提示失败，直至失败次数上限

可能原因：未加载依赖的播放列表、当前使用或曾使用的播放列表call中存在错误、未允许访问某个域名或配置问题、网络问题。

排查：依照可能原因进行检查，或者依照日志和浏览器控制台信息进行排查问题（需要部分JavaScript开发经验，能看懂<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Errors" title="JavaScript 错误参考" rel="external">错误信息</a>）。

#### 加载播放列表后过了很久提示失败，一直重复到失败次数上限

可能原因：默认使用的代理端口不存在、网络问题。

因为`Github Page`是静态服务器，所以自然没有办法转发HTTP请求。

解决方法：按照本文其它部分所写的来尝试解决该问题，或使用浏览器的开发者工具确定问题。

## 数据

数据结构的基础就是一个个的播放列表文件，文件采用JSON格式，另附有对应的[JSON Schema 符号表](/assets/symbol/JSON_Schema/playlist.schema.json)可用。

在加载数据文件前想一想：这个文件是否是你想要的，是不是可信来源的，是不是用文本编辑器打开确认过是安全的。

由于audioplay允许在一定的情况下修改UI文本，所以才会导致这些隐患。

以后可能会对数据文件开放更多的功能，所以永远需要验证数据文件的安全性。

同时audioplay接受通过URL查询参数来自动加载数据文件，请务必确认查询参数是否信任（虽然你可能看不懂，如果看不懂干脆直接不要访问），特别是`href`和`lang`，详见其它段落。

如果播放列表为空但有其它的有效数据，依旧会加载，只是不会播放而已。因此你可以提前加载一些东西，例如`call`调用表作为库，提前加载I18N文件来看得懂文本。

## URL查询参数

### `href`

可以使用一个或多个`href`参数来加载数据文件，程序会按顺序进行请求，按响应顺序异步加载。

**注意：** `href`参数可以加载任何位置的文件，只要能通过浏览器安全检查。

### `lang`

这个目的是提供国际化功能，通过拼合`/assets/playlist/${lang参数的数据}.i18n.json`来产生链接。将会在`href`之后进行请求。

虽然URL是拼合的，但并不代表一定安全。

### `extension`

该参数用于加载扩展，路径必须为当前路径下同名文件夹内的文件。

可以存在多个参数，将按一定顺序开始加载。

示例：一个扩展的路径为 `/resource/audioplay/random_play.js` ，查询参数应为 `extension=random_play.js` 。

若需要第三方扩展请自行注入脚本，推荐使用`loadScript`函数加载扩展脚本。

### `keep_verbose_log`

一旦存在该参数，将会启用“记录详细日志”功能。

## 翻译指引

~~（虽然感觉不会有人来翻译，但它本身是有留本地化接口）~~

大部分UI文本都存储在`uiText`常量内，你可以直接通过浏览器控制台获取数据，有时我也会导出这些文本存储在[zh-CN.i18n.json](/assets/playlist/zh-CN.i18n.json)内。但建议直接从常量中获得，因为我可能会导出不及时。

原始语言为“中文-中国”。

虽然你可以直接修改我导出的UI文本数据，但我不建议直接这么做。至少你这么做的时候先把文件名还有元数据清理一下，然后按照后面的内容编写。

在编写本地化文本前最好对数据结构有基本了解。

### 编写本地化UI文本

首先，新建文件，文件名按照`[1].i18n.json`的格式来命名。其中，`[1]`是国家语言代码(ISO3166,ISO639)。若只是个人或有限范围使用那随意。

然后使用如下基本结构：

```json
{
	"title": "",
	"meta": {
		"desc": "本地化翻译",
		"language": "",
		"target_version": ""
	},
	"UIText": {
	}
}
```

在`title`内填入你想要的标题，例：`英文翻译`。

在`meta`内填写或添加自定义元数据，后面会列出建议的元数据。

在`UIText`部分添加你所要翻译的条目。

**建议的元数据和对应的含义：**

- `desc` 用作介绍，内容自定，可以简单介绍一下翻译情况之类的。

- `language` 填入国家语言代码

- `target_version` 填入对应的版本号，你为哪个版本进行翻译就填哪个版本。版本号从更新日志里查看，或者参照[zh-CN.i18n.json](/assets/playlist/zh-CN.i18n.json)的`source_version`元数据来确定，实在不行就填编写完成的日期。

## 试用

在点击前先鼠标悬停或者手机上长按看看链接（部分浏览器可能没有链接显示功能），虽然本文提供的链接是较为安全的，但还是建议检查。

[普通的直接查看页面](/resource/audioplay.html) 此时只会加载基本页面，没有什么会播放。

[加载UI文本（利用lang参数）](/resource/audioplay.html?lang=live) 这个示例只会把“正在播放”改为“背景音乐”。

[加载默认调用依赖](/resource/audioplay.html?href=%2Fassets%2Fplaylist%2Fau_call.json) 这个示例会加载一些调用依赖，想要播放还是需要自己加载文件。

[把上面的示例都加载](/resource/audioplay.html?lang=live&href=%2Fassets%2Fplaylist%2Fau_call.json) 加载了`lang`和`href`的示例。

下面的试用都需要油猴脚本来辅助播放。

现在可用[hy](/assets/playlist/mhya_w4y.json)这个播放列表进行测试，建议手动使用该链接，需要提前加载`au_call.json`（直接使用示例3也行）。也可以[直接在查询参数使用](/resource/audioplay.html?href=%2Fassets%2Fplaylist%2Fau_call.json&href=%2Fassets%2Fplaylist%2Fmhya_w4y.json)，不过**可能会出现依赖未加载**的情况*（我对此链接测试的时候就有出现）*。

[听Minecraft音乐](/resource/audioplay.html?href=%2Fassets%2Fplaylist%2Fminecraft.json)

## 通过油猴脚本获取资源

详见[本站页面访问其它资源辅助脚本]({% post_url 2025-01-16-page_network_userjs %})

利用这个脚本，可以允许call跨站访问链接，不过需要你自己添加允许的域名。

若疯狂提示失败（在1秒内全部失败）并提示失败次数超过阈值，请检查是否添加好允许的域名。

<details>
<summary>au_call.json 需要的域名</summary>
<p><code>music.163.com</code> <del>另附<a href="/static/tools/getwyyyypl.py">简单的播放列表转换</a>（不提供帮助支持）</del><ins></ins></p>
<p><code>m.kugou.com</code></p>
</details>

## 其它播放列表收集处

我在另一个站点提供了一些播放列表: [点此链接](https://qskn.pages.dev/assets/playlist/)
